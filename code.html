<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>少儿编程答题</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="questions.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E88E5',
                        secondary: '#FF9800',
                        success: '#4CAF50',
                        danger: '#F44336',
                        neutral: '#F5F5F5'
                    },
                    fontFamily: {
                        sans: ['Arial', 'sans-serif']
                    },
                    animation: {
                        'bounce-short': 'bounce 0.5s ease-in-out',
                        'pulse-fast': 'pulse 1s ease-in-out',
                        'shake': 'shake 0.5s ease-in-out'
                    },
                    keyframes: {
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-5px)' },
                            '75%': { transform: 'translateX(5px)' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .card-shadow {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .btn-shadow {
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .btn-shadow:active {
                transform: translateY(2px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body class="bg-neutral min-h-screen">
    <!-- 页面容器 - 响应式设计 -->
    <div id="app" class="container mx-auto px-4 py-4 sm:py-8 max-w-6xl">
        <!-- 页面内容将通过JavaScript动态加载 -->
    </div>

    <script>
        // 页面路由管理
        const router = {
            routes: {},
            currentRoute: null,
            
            addRoute(path, handler) {
                this.routes[path] = handler;
            },
            
            navigateTo(path, params = {}) {
                this.currentRoute = path;
                const handler = this.routes[path];
                if (handler) {
                    handler(params);
                }
            }
        };

        // 当前选中的题目数据
        let quizData = [];
        let currentCategory = '';

        // 全局状态管理
        const appState = {
            currentQuestionIndex: 0,
            userAnswers: [],
            score: 0,
            
            reset() {
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.score = 0;
            },
            
            saveAnswer(questionId, userAnswer) {
                this.userAnswers.push({
                    questionId,
                    userAnswer,
                    isCorrect: this.checkAnswer(questionId, userAnswer)
                });
                
                if (this.userAnswers[this.userAnswers.length - 1].isCorrect) {
                    this.score++;
                }
            },
            
            checkAnswer(questionId, userAnswer) {
                const question = quizData.find(q => q.id === questionId);
                if (!question) return false;
                
                console.log('检查答案:', {
                    questionId,
                    userAnswer,
                    questionAnswer: question.answer,
                    questionType: question.type
                });
                
                // 现在只处理单选题和判断题，userAnswer是包含一个元素的数组
                return userAnswer[0] === question.answer;
            },
            
            getProgress() {
                return (this.currentQuestionIndex / quizData.length) * 100;
            }
        };

        // 页面组件
        const pages = {
            // 级别选择页面 - Scratch 1-4级，其他类别1-8级
            levelSelectPage() {
                const app = document.getElementById('app');
                
                // 根据当前类别获取显示名称
                const categoryName = currentCategory === 'scratch' ? 'Scratch' : 
                                   currentCategory === 'python' ? 'Python' : 'C++';
                
                // 根据类别配置不同的级别数据
                let levels;
                if (currentCategory === 'scratch') {
                    // Scratch只有1-4级
                    levels = [
                        { level: 1, color: 'green', name: '入门级', desc: '基础概念，适合初学者' },
                        { level: 2, color: 'blue', name: '基础级', desc: '掌握基本编程逻辑' },
                        { level: 3, color: 'yellow', name: '进阶级', desc: '综合应用编程知识' },
                        { level: 4, color: 'red', name: '挑战级', desc: '高级编程技巧挑战' }
                    ];
                } else {
                    // Python和C++有1-8级
                    levels = [
                        { level: 1, color: 'green', name: '入门级', desc: '基础概念入门' },
                        { level: 2, color: 'blue', name: '基础级', desc: '基本语法掌握' },
                        { level: 3, color: 'cyan', name: '进阶级', desc: '核心概念应用' },
                        { level: 4, color: 'yellow', name: '提高级', desc: '综合技能提升' },
                        { level: 5, color: 'orange', name: '挑战级', desc: '高级编程技巧' },
                        { level: 6, color: 'red', name: '专家级', desc: '复杂问题解决' },
                        { level: 7, color: 'purple', name: '大师级', desc: '算法思维训练' },
                        { level: 8, color: 'indigo', name: '创新级', desc: '创新应用开发' }
                    ];
                }
                
                app.innerHTML = `
                    <div class="bg-white rounded-3xl p-6 sm:p-8 md:p-10 card-shadow">
                        <div class="text-center mb-10">
                            <h2 class="text-4xl font-bold text-gray-800 mb-4">选择${categoryName}难度级别</h2>
                            <p class="text-xl text-gray-600">从简单到困难，循序渐进提升编程能力！</p>
                        </div>
                        
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-4 sm:gap-6">
                            ${levels.map(level => `
                                <div class="bg-gradient-to-br from-${level.color}-400 to-${level.color}-600 rounded-2xl p-6 text-center cursor-pointer transform transition-all duration-300 hover:scale-105 hover:shadow-lg" onclick="selectLevel(${level.level})">
                                    <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center mx-auto mb-3">
                                        <span class="text-2xl font-bold text-${level.color}-600">${level.level}</span>
                                    </div>
                                    <h3 class="text-xl font-bold text-white mb-1">${level.name}</h3>
                                    <p class="text-white opacity-90 text-xs">${level.desc}</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-10 text-center">
                            <button id="back-to-home-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-4 px-12 rounded-xl btn-shadow text-xl">
                                <i class="fa fa-arrow-left mr-2"></i> 返回首页
                            </button>
                        </div>
                    </div>
                `;
                
                // 添加返回首页按钮事件
                setTimeout(() => {
                    const backBtn = document.getElementById('back-to-home-btn');
                    if (backBtn) {
                        backBtn.addEventListener('click', function() {
                            router.navigateTo('homePage');
                        });
                    }
                }, 100);
            },
            
            // 首页 - 全新风格设计
            homePage() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="space-y-12">
                        <!-- 顶部横幅 - 科技风格 -->
                        <div class="relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 opacity-90"></div>
                            <!-- 装饰性代码背景 -->
                            <div class="absolute inset-0 opacity-10">
                                <div class="text-[8px] text-white font-mono leading-none">
                                    ${Array(20).fill().map(() => 
                                        Array(100).fill().map(() => 
                                            Math.random() > 0.5 ? '1' : '0'
                                        ).join('')
                                    ).join('<br>')}
                                </div>
                            </div>
                            <div class="relative z-10 rounded-3xl p-8 sm:p-12 md:p-16 text-center">
                                <div class="flex flex-col sm:flex-row items-center justify-center gap-6 sm:gap-8 mb-6 sm:mb-8">
                                    <div class="w-24 h-24 sm:w-28 sm:h-28 md:w-32 md:h-32 bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white border-opacity-30">
                                        <img src="https://img.icons8.com/color/128/000000/brain-circuit.png" alt="Logo" class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 animate-pulse-fast">
                                    </div>
                                    <div>
                                        <h1 class="text-5xl sm:text-6xl md:text-7xl font-bold mb-4 text-white text-shadow">
                                            <span class="bg-clip-text text-transparent bg-gradient-to-r from-yellow-300 to-pink-300">CodeQuiz</span>
                                        </h1>
                                        <p class="text-xl sm:text-2xl md:text-3xl text-white text-opacity-90 font-light">
                                            编程知识挑战平台
                                        </p>
                                    </div>
                                </div>
                                <div class="text-xl text-white text-opacity-80 max-w-2xl mx-auto">
                                    选择你要挑战的编程语言，开启编程知识之旅！支持GESP和电子协会
                                </div>
                            </div>
                        </div>
                        
                        <!-- 编程语言类别 - 卡片风格 -->
                        <div>
                            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">选择编程语言</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <!-- Scratch -->
                                <div class="group" onclick="selectCategory('scratch')">
                                    <div class="bg-white rounded-2xl overflow-hidden card-shadow transform transition-all duration-500 group-hover:scale-105 group-hover:shadow-xl">
                                        <div class="h-48 bg-gradient-to-br from-yellow-400 to-orange-500 relative overflow-hidden">
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <i class="fa fa-cubes text-white text-8xl opacity-20"></i>
                                            </div>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                                                    <i class="fa fa-cubes text-orange-500 text-4xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-8">
                                            <h3 class="text-2xl font-bold text-gray-800 mb-3">Scratch</h3>
                                            <p class="text-gray-600 mb-6">图形化编程，适合初学者入门</p>
                                            <div class="flex items-center text-sm text-orange-500 font-medium">
                                                <span>开始挑战</span>
                                                <i class="fa fa-arrow-right ml-2 transform transition-transform group-hover:translate-x-1"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Python -->
                                <div class="group" onclick="selectCategory('python')">
                                    <div class="bg-white rounded-2xl overflow-hidden card-shadow transform transition-all duration-500 group-hover:scale-105 group-hover:shadow-xl">
                                        <div class="h-48 bg-gradient-to-br from-blue-400 to-blue-600 relative overflow-hidden">
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <i class="fa fa-python text-white text-8xl opacity-20"></i>
                                            </div>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                                                    <i class="fa fa-python text-blue-600 text-4xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-8">
                                            <h3 class="text-2xl font-bold text-gray-800 mb-3">Python</h3>
                                            <p class="text-gray-600 mb-6">简洁易学，人工智能首选语言</p>
                                            <div class="flex items-center text-sm text-blue-600 font-medium">
                                                <span>开始挑战</span>
                                                <i class="fa fa-arrow-right ml-2 transform transition-transform group-hover:translate-x-1"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- C++ -->
                                <div class="group" onclick="selectCategory('cpp')">
                                    <div class="bg-white rounded-2xl overflow-hidden card-shadow transform transition-all duration-500 group-hover:scale-105 group-hover:shadow-xl">
                                        <div class="h-48 bg-gradient-to-br from-purple-600 to-indigo-800 relative overflow-hidden">
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <i class="fa fa-code text-white text-8xl opacity-20"></i>
                                            </div>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                                                    <i class="fa fa-code text-indigo-800 text-4xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-8">
                                            <h3 class="text-2xl font-bold text-gray-800 mb-3">C++</h3>
                                            <p class="text-gray-600 mb-6">高性能语言，算法竞赛首选</p>
                                            <div class="flex items-center text-sm text-indigo-600 font-medium">
                                                <span>开始挑战</span>
                                                <i class="fa fa-arrow-right ml-2 transform transition-transform group-hover:translate-x-1"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 特色介绍 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-gradient-to-br from-cyan-50 to-blue-100 rounded-2xl p-8 border border-blue-200">
                                <div class="w-16 h-16 bg-blue-500 rounded-xl flex items-center justify-center mb-6">
                                    <i class="fa fa-graduation-cap text-white text-3xl"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">考级辅导</h3>
                                <p class="text-gray-600">专业的GESP和电子协会考级辅导，帮助你顺利通过编程等级考试</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-pink-100 rounded-2xl p-8 border border-pink-200">
                                <div class="w-16 h-16 bg-purple-500 rounded-xl flex items-center justify-center mb-6">
                                    <i class="fa fa-trophy text-white text-3xl"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">分级挑战</h3>
                                <p class="text-gray-600">从入门到精通的分级题库，循序渐进提升你的编程技能</p>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-2xl p-8 border border-emerald-200">
                                <div class="w-16 h-16 bg-green-500 rounded-xl flex items-center justify-center mb-6">
                                    <i class="fa fa-lightbulb-o text-white text-3xl"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">即时反馈</h3>
                                <p class="text-gray-600">每道题都有详细解析，帮助你理解编程概念和解题思路</p>
                            </div>
                        </div>
                        
                        <!-- 底部信息 -->
                        <div class="text-center text-gray-500 text-sm pt-8 border-t border-gray-200">
                            <p>© 2024 CodeQuiz 编程知识挑战平台 | 专注少儿编程教育</p>
                        </div>
                    </div>
                `;
            },
            
            // 答题页面
            quizPage() {
                const currentQuestion = quizData[appState.currentQuestionIndex];
                const app = document.getElementById('app');
                
                // 先渲染选项，避免this上下文问题
                const optionsHtml = pages.renderOptions(currentQuestion);
                
                app.innerHTML = `
                    <div class="bg-white rounded-3xl p-6 sm:p-8 md:p-10 card-shadow">
                        <!-- 顶部信息栏 -->
                        <div class="flex justify-between items-center mb-8">
                            <div class="text-2xl font-bold text-gray-800">
                                问题 ${appState.currentQuestionIndex + 1}/${quizData.length}
                            </div>
                            <div class="text-xl text-gray-600">
                                ${currentQuestion.type === 'single' ? '单选题' : '判断题'}
                            </div>
                        </div>
                        
                        <!-- 进度条 -->
                        <div class="mb-10">
                            <div class="w-full bg-gray-200 rounded-full h-6">
                                <div class="bg-primary h-6 rounded-full transition-all duration-500" style="width: ${appState.getProgress()}%"></div>
                            </div>
                        </div>
                        
                        <!-- 问题卡片 -->
                        <div class="mb-10">
                            <div class="flex items-start mb-8">
                                <div class="bg-blue-100 p-4 rounded-2xl mr-6">
                                    <img src="${currentQuestion.image}" alt="Question" class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24">
                                </div>
                                <div class="flex-1">
                                    <h2 class="text-2xl sm:text-2xl md:text-3xl font-bold text-gray-800 mb-4">${currentQuestion.question}</h2>

                                </div>
                            </div>
                            
                            <!-- 选项区域 -->
                            <div id="options-container" class="space-y-4 max-w-3xl">
                                ${optionsHtml}
                            </div>
                        </div>
                        
                        <!-- 操作按钮 -->
                        <div class="flex justify-between">
                            <button id="back-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-4 px-8 rounded-xl btn-shadow text-xl">
                                <i class="fa fa-arrow-left mr-2"></i> 返回
                            </button>
                            <button id="next-btn" class="bg-primary hover:bg-blue-600 text-white font-bold py-4 px-12 rounded-xl btn-shadow opacity-50 cursor-not-allowed text-xl" disabled>
                                下一题 <i class="fa fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // 使用pages对象调用方法，避免this上下文问题
                pages.setupQuizEventListeners(currentQuestion);
            },
            
            // 渲染选项 - 大屏版（只保留单选和判断题）
            renderOptions(question) {
                // 单选题和判断题都使用单选按钮
                return question.options.map((option, index) => `
                    <label class="flex items-center p-4 sm:p-5 md:p-6 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-blue-50 transition-all duration-300 transform hover:scale-[1.02]">
                        <div class="w-8 h-8 border-2 border-gray-300 rounded-full flex items-center justify-center mr-4 transition-colors">
                            <input type="radio" name="question_${question.id}" value="${index}" class="hidden peer">
                            <div class="w-4 h-4 rounded-full bg-primary opacity-0 peer-checked:opacity-100 transition-opacity"></div>
                        </div>
                        <span class="text-base sm:text-lg md:text-xl font-medium text-gray-800">${option}</span>
                    </label>
                `).join('');
            },
            
            // 设置答题页面事件监听
            setupQuizEventListeners(question) {
                const optionsContainer = document.getElementById('options-container');
                const nextBtn = document.getElementById('next-btn');
                const backBtn = document.getElementById('back-btn');
                
                let selectedOptions = [];
                let answered = false;
                
                // 选项点击事件
                optionsContainer.addEventListener('change', (e) => {
                    if (answered) return;
                    
                    // 现在只处理单选题和判断题
                    selectedOptions = [parseInt(e.target.value)];
                    
                    // 启用下一题按钮
                    if (selectedOptions.length > 0) {
                        nextBtn.disabled = false;
                        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        nextBtn.disabled = true;
                        nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                });
                
                // 下一题按钮点击事件
                nextBtn.addEventListener('click', () => {
                    if (answered || selectedOptions.length === 0) return;
                    
                    answered = true;
                    pages.showAnswerFeedback(question, selectedOptions);
                    
                    // 保存答案
                    appState.saveAnswer(question.id, selectedOptions);
                    
                    // 跳转逻辑现在在弹窗中处理
                });
                
                // 移除之前可能存在的事件监听器
                const newBackBtn = backBtn.cloneNode(true);
                backBtn.parentNode.replaceChild(newBackBtn, backBtn);
                
                // 重新获取按钮引用
                const updatedBackBtn = document.getElementById('back-btn');
                
                // 返回按钮点击事件 - 使用新的按钮引用
                updatedBackBtn.addEventListener('click', function() {
                    console.log('返回按钮被点击');
                    
                    // 直接返回首页，不显示确认对话框
                    console.log('正在返回首页...');
                    
                    // 重置应用状态
                    appState.reset();
                    
                    // 根据当前类别决定返回路径
                    if (currentCategory === 'scratch') {
                        router.navigateTo('levelSelectPage');
                    } else {
                        router.navigateTo('homePage');
                    }
                });
                
                // 确保按钮样式正确
                updatedBackBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                updatedBackBtn.classList.add('cursor-pointer');
                updatedBackBtn.style.pointerEvents = 'auto';
                updatedBackBtn.disabled = false;
            },
            
            // 显示答案反馈 - 使用弹窗
            showAnswerFeedback(question, userAnswer) {
                const isCorrect = appState.checkAnswer(question.id, userAnswer);
                
                // 创建弹窗
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-60';
                modal.innerHTML = `
                    <div class="bg-white rounded-3xl p-10 max-w-lg w-full mx-4 transform transition-all duration-300 scale-110">
                        <div class="text-center mb-6">
                            <div class="w-24 h-24 mx-auto mb-4 rounded-full bg-${isCorrect ? 'success' : 'danger'} flex items-center justify-center">
                                <i class="fa fa-${isCorrect ? 'check' : 'times'}-circle text-white text-4xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">${isCorrect ? '回答正确！' : '回答错误'}</h3>
                            <p class="text-lg text-gray-600">${question.explanation}</p>
                        </div>
                        
                        <div class="bg-gray-50 rounded-xl p-4 mb-6">
                            <p class="text-gray-700 mb-2"><strong>你的答案：</strong>${question.options[userAnswer[0]]}</p>
                            <p class="text-gray-700"><strong>正确答案：</strong>${question.options[question.answer]}</p>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-gray-500 mb-4">将在 <span id="countdown" class="font-bold text-primary">3</span> 秒后自动跳转到下一题</p>
                            <button id="next-now-btn" class="bg-primary hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-xl btn-shadow text-lg">
                                立即下一题
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // 倒计时功能
                let countdown = 3;
                const countdownEl = modal.querySelector('#countdown');
                const nextNowBtn = modal.querySelector('#next-now-btn');
                
                const timer = setInterval(() => {
                    countdown--;
                    countdownEl.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(timer);
                        document.body.removeChild(modal);
                        goToNextQuestion();
                    }
                }, 1000);
                
                // 立即下一题按钮
                nextNowBtn.addEventListener('click', () => {
                    clearInterval(timer);
                    document.body.removeChild(modal);
                    goToNextQuestion();
                });
                
                // 跳转到下一题的函数
                function goToNextQuestion() {
                    appState.currentQuestionIndex++;
                    if (appState.currentQuestionIndex < quizData.length) {
                        router.navigateTo('quizPage');
                    } else {
                        router.navigateTo('resultPage');
                    }
                }
            },
            
            // 结果页面
            resultPage() {
                const app = document.getElementById('app');
                const correctCount = appState.score;
                const totalCount = quizData.length;
                const percentage = Math.round((correctCount / totalCount) * 100);
                
                let message, icon, color;
                
                if (percentage >= 80) {
                    message = '太棒了！你是编程小天才！';
                    icon = 'trophy';
                    color = 'success';
                } else if (percentage >= 60) {
                    message = '做得不错！继续加油！';
                    icon = 'star';
                    color = 'primary';
                } else {
                    message = '别灰心，多练习就能进步！';
                    icon = 'heart';
                    color = 'secondary';
                }
                
                app.innerHTML = `
                    <div>
                        <!-- 结果总览卡片 -->
                        <div class="bg-white rounded-3xl p-6 sm:p-8 md:p-10 card-shadow mb-8">
                            <div class="grid grid-cols-2 gap-8 items-center">
                                <!-- 左侧：统计信息 -->
                                <div>
                                    <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-800 mb-4">${currentCategory === 'scratch' ? 'Scratch' : currentCategory === 'python' ? 'Python' : 'C++'}答题完成！</h1>
                                    <p class="text-2xl text-gray-600 mb-8">${message}</p>
                                    
                                    <!-- 主要统计数据 -->
                                    <div class="mb-10">
                                        <div class="text-8xl font-bold text-${color} mb-4">${percentage}%</div>
                                        <p class="text-xl text-gray-600">正确率</p>
                                    </div>
                                    
                                    <!-- 详细统计 -->
                                    <div class="grid grid-cols-3 gap-6 mb-8">
                                        <div class="bg-green-50 rounded-2xl p-6 text-center">
                                            <div class="text-4xl font-bold text-success mb-2">${correctCount}</div>
                                            <p class="text-gray-700">正确题数</p>
                                        </div>
                                        <div class="bg-red-50 rounded-2xl p-6 text-center">
                                            <div class="text-4xl font-bold text-danger mb-2">${totalCount - correctCount}</div>
                                            <p class="text-gray-700">错误题数</p>
                                        </div>
                                        <div class="bg-blue-50 rounded-2xl p-6 text-center">
                                            <div class="text-4xl font-bold text-primary mb-2">${totalCount}</div>
                                            <p class="text-gray-700">总题数</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 操作按钮 -->
                                    <div class="flex space-x-4">
                                        <button id="retry-btn" class="bg-primary hover:bg-blue-600 text-white text-xl font-bold py-4 px-10 rounded-xl btn-shadow transition-all duration-300 transform hover:scale-105 flex-1">
                                            <i class="fa fa-refresh mr-2"></i> 重新挑战
                                        </button>
                                        <button id="home-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 text-xl font-bold py-4 px-10 rounded-xl btn-shadow transition-all duration-300 flex-1">
                                            <i class="fa fa-home mr-2"></i> 返回首页
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- 右侧：成就展示 -->
                                <div class="flex justify-center">
                                    <div class="relative">
                                        <!-- 成就徽章 -->
                                        <div class="w-64 h-64 rounded-full bg-${color} flex items-center justify-center animate-bounce-short">
                                            <i class="fa fa-${icon} text-white text-9xl"></i>
                                        </div>
                                        <!-- 装饰元素 -->
                                        <div class="absolute -top-4 -right-4 w-20 h-20 bg-yellow-400 rounded-full flex items-center justify-center animate-pulse-fast">
                                            <i class="fa fa-star text-white text-3xl"></i>
                                        </div>
                                        <div class="absolute -bottom-4 -left-4 w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center animate-pulse-fast" style="animation-delay: 0.5s;">
                                            <i class="fa fa-trophy text-white text-2xl"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 错题解析 -->
                        ${pages.renderWrongAnswers()}
                        

                    </div>
                `;
                
                document.getElementById('retry-btn').addEventListener('click', () => {
                    appState.reset();
                    router.navigateTo('quizPage');
                });
                
                document.getElementById('home-btn').addEventListener('click', () => {
                    router.navigateTo('homePage');
                });
            },
            
            // 渲染错题解析
            renderWrongAnswers() {
                const wrongAnswers = appState.userAnswers.filter(a => !a.isCorrect);
                
                if (wrongAnswers.length === 0) {
                    return '';
                }
                
                return `
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">错题解析</h3>
                        <div class="space-y-6">
                            ${wrongAnswers.map(answer => {
                                const question = quizData.find(q => q.id === answer.questionId);
                                return `
                                    <div class="border-l-4 border-danger pl-4">
                                        <h4 class="font-bold text-gray-800 mb-2">${question.question}</h4>
                                        <p class="text-danger mb-2">你的答案: ${this.formatUserAnswer(question, answer.userAnswer)}</p>
                                        <p class="text-success mb-2">正确答案: ${this.formatCorrectAnswer(question)}</p>
                                        <p class="text-gray-600">${question.explanation}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            },
            
            // 格式化用户答案
            formatUserAnswer(question, userAnswer) {
                if (question.type === 'multiple') {
                    return userAnswer.map(index => question.options[index]).join(', ');
                }
                return question.options[userAnswer[0]];
            },
            
            // 格式化正确答案
            formatCorrectAnswer(question) {
                if (question.type === 'multiple') {
                    return question.answer.map(index => question.options[index]).join(', ');
                }
                return question.options[question.answer];
            }
        };

        // 通用级别选择函数 - 支持所有类别1-8级
        function selectLevel(level) {
            console.log('选择级别:', level, '类别:', currentCategory);
            
            // 根据当前类别和级别获取题目数据
            const levelKey = `level${level}`;
            
            // 显示年份选择弹窗
            showYearSelectModal(level);
        }
        
        // 显示年份选择弹窗
        function showYearSelectModal(level) {
            // 创建弹窗容器
            const modalContainer = document.createElement('div');
            modalContainer.className = 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-60';
            modalContainer.id = 'year-select-modal';
            
            // 获取当前类别名称
            const categoryName = currentCategory === 'scratch' ? 'Scratch' : 
                               currentCategory === 'python' ? 'Python' : 'C++';
            
            // 获取该类别的所有年份
            const examTypes = window.currentExamType ? [window.currentExamType] : Object.keys(allQuizData[currentCategory] || {});
            let years = [];
            
            // 从所有考级类型中收集年份
            examTypes.forEach(examType => {
                if (allQuizData[currentCategory][examType]) {
                    const examTypeYears = Object.keys(allQuizData[currentCategory][examType]);
                    years = [...new Set([...years, ...examTypeYears])];
                }
            });
            
            years.sort((a, b) => b - a); // 按年份降序排列
            console.log('可用的年份:', years);
            
            modalContainer.innerHTML = `
                <div class="bg-white rounded-3xl p-10 max-w-md w-full mx-4 transform transition-all duration-300 scale-110">
                    <div class="text-center mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-4">选择${categoryName} ${level}级年份</h3>
                        <p class="text-xl text-gray-600">请选择您要练习的题目年份</p>
                    </div>
                    
                    <div class="space-y-4">
                        ${years.length > 0 ? years.map(year => `
                            <button onclick="selectYear('${year}', ${level})" 
                                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xl font-bold py-4 px-8 rounded-xl btn-shadow hover:shadow-lg transform transition-all duration-300 hover:scale-[1.02]">
                                <div class="flex items-center justify-center">
                                    <i class="fa fa-calendar text-2xl mr-4"></i>
                                    <span>${year}年题目</span>
                                </div>
                            </button>
                        `).join('') : `
                            <div class="text-center py-8 text-gray-600">
                                <i class="fa fa-info-circle text-4xl mb-4"></i>
                                <p>暂无可选年份数据</p>
                            </div>
                        `}
                        
                        <!-- 取消按钮 -->
                        <button onclick="closeYearSelectModal()" 
                                class="w-full bg-gray-200 text-gray-800 text-lg font-bold py-3 px-8 rounded-xl hover:bg-gray-300 transition-colors duration-300">
                            取消
                        </button>
                    </div>
                </div>
            `;
            
            // 添加到页面
            document.body.appendChild(modalContainer);
            
            // 添加动画效果
            setTimeout(() => {
                modalContainer.querySelector('div').classList.remove('scale-110');
                modalContainer.querySelector('div').classList.add('scale-100');
            }, 10);
        }
        
        // 选择年份
        function selectYear(year, level) {
            console.log('选择年份:', year, '级别:', level, '类别:', currentCategory, '考级类型:', window.currentExamType);
            
            // 获取该年份该级别的题目数据
            const levelKey = `level${level}`;
            let collectedQuizData = [];
            
            // 从所有考级类型中收集该年份该级别的题目
            const examTypes = window.currentExamType ? [window.currentExamType] : Object.keys(allQuizData[currentCategory] || {});
            console.log('可用的考级类型:', examTypes);
            
            examTypes.forEach(examType => {
                console.log(`检查考级类型: ${examType}`);
                console.log(`是否存在该考级类型: ${!!allQuizData[currentCategory][examType]}`);
                
                if (allQuizData[currentCategory][examType]) {
                    console.log(`该考级类型的年份: ${Object.keys(allQuizData[currentCategory][examType])}`);
                    console.log(`是否存在${year}年: ${!!allQuizData[currentCategory][examType][year]}`);
                    
                    if (allQuizData[currentCategory][examType][year]) {
                        console.log(`该年份的级别: ${Object.keys(allQuizData[currentCategory][examType][year])}`);
                        console.log(`是否存在${levelKey}: ${!!allQuizData[currentCategory][examType][year][levelKey]}`);
                        
                        if (allQuizData[currentCategory][examType][year][levelKey]) {
                            const questions = allQuizData[currentCategory][examType][year][levelKey];
                            console.log(`从${examType} ${year} ${levelKey}获取到${questions.length}题`);
                            collectedQuizData = [...collectedQuizData, ...questions];
                        }
                    }
                }
            });
            
            quizData = collectedQuizData;
            
            // 添加级别和年份信息到题目数据中
            quizData = quizData.map(q => ({
                ...q,
                level: level,
                year: year
            }));
            
            console.log('获取到的题目数量:', quizData.length);
            
            if (quizData.length === 0) {
                alert('该年份该级别的题目数据暂未收录');
                closeYearSelectModal();
                return;
            }
            
            // 关闭弹窗
            closeYearSelectModal();
            
            // 进入答题页面
            router.navigateTo('quizPage');
        }
        
        // 关闭年份选择弹窗
        function closeYearSelectModal() {
            const modal = document.getElementById('year-select-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 类别选择函数 - 添加考级类型选择弹窗
        function selectCategory(category) {
            console.log('选择类别:', category);
            currentCategory = category;
            appState.reset();
            
            // 显示选中效果 - 安全地获取元素
            const categoryElements = document.querySelectorAll('[onclick^="selectCategory"]');
            categoryElements.forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white', 'scale-105');
            });
            
            // 尝试获取当前点击的元素，但不依赖event
            const currentElement = document.querySelector(`[onclick="selectCategory('${category}')"]`);
            if (currentElement) {
                currentElement.classList.add('ring-4', 'ring-white', 'scale-105');
            }
            
            // 延迟后显示考级类型选择弹窗
            setTimeout(() => {
                showExamTypeModal();
            }, 500);
        }
        
        // 显示考级类型选择弹窗
        function showExamTypeModal() {
            // 创建弹窗容器
            const modalContainer = document.createElement('div');
            modalContainer.className = 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-60';
            modalContainer.id = 'exam-type-modal';
            
            // 获取当前类别名称
            const categoryName = currentCategory === 'scratch' ? 'Scratch' : 
                               currentCategory === 'python' ? 'Python' : 'C++';
            
            modalContainer.innerHTML = `
                <div class="bg-white rounded-3xl p-10 max-w-md w-full mx-4 transform transition-all duration-300 scale-110">
                    <div class="text-center mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-4">选择${categoryName}考级类型</h3>
                        <p class="text-xl text-gray-600">请选择您要练习的考级类型</p>
                    </div>
                    
                    <div class="space-y-4">
                        <button onclick="selectExamType('gesp')" 
                                class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xl font-bold py-4 px-8 rounded-xl btn-shadow hover:shadow-lg transform transition-all duration-300 hover:scale-[1.02]">
                            <div class="flex items-center justify-center">
                                <i class="fa fa-graduation-cap text-2xl mr-4"></i>
                                <span>GESP考级</span>
                            </div>
                        </button>
                        
                        <button onclick="selectExamType('electronic')" 
                                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white text-xl font-bold py-4 px-8 rounded-xl btn-shadow hover:shadow-lg transform transition-all duration-300 hover:scale-[1.02]">
                            <div class="flex items-center justify-center">
                                <i class="fa fa-microchip text-2xl mr-4"></i>
                                <span>电子协会考级</span>
                            </div>
                        </button>
                        
                        <!-- 取消按钮 -->
                        <button onclick="closeExamTypeModal()" 
                                class="w-full bg-gray-200 text-gray-800 text-lg font-bold py-3 px-8 rounded-xl hover:bg-gray-300 transition-colors duration-300">
                            取消
                        </button>
                    </div>
                </div>
            `;
            
            // 添加到页面
            document.body.appendChild(modalContainer);
            
            // 添加动画效果
            setTimeout(() => {
                modalContainer.querySelector('div').classList.remove('scale-110');
                modalContainer.querySelector('div').classList.add('scale-100');
            }, 10);
        }
        
        // 选择考级类型
        function selectExamType(examType) {
            console.log('选择考级类型:', examType, '类别:', currentCategory);
            
            // 保存考级类型
            window.currentExamType = examType;
            
            // 关闭弹窗
            closeExamTypeModal();
            
            // 跳转到级别选择页面
            router.navigateTo('levelSelectPage');
        }
        
        // 关闭考级类型选择弹窗
        function closeExamTypeModal() {
            const modal = document.getElementById('exam-type-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            console.log('应用初始化');
            
            // 注册路由
            router.addRoute('homePage', pages.homePage);
            router.addRoute('levelSelectPage', pages.levelSelectPage);
            router.addRoute('quizPage', pages.quizPage);
            router.addRoute('resultPage', pages.resultPage);
            
            // 导航到首页
            setTimeout(() => {
                router.navigateTo('homePage');
            }, 100);
        });
    </script>
</body>
</html>
