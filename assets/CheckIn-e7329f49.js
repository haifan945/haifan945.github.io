import{_ as A,c as H,o as Q,a as R,b as B,e as t,w as n,E as W,d as a,u as b,ah as D,t as f,k as Y,ai as G,F as J,m as K,l as h,r as c,ae as z,ab as w,n as X,R as Z,S as ee,aj as te,P as ae,T as se,q as ne,s as le,U as oe,y as ce,Q as ie}from"./index-dab368ea.js";/* empty css                      */import"./request-afa285ff.js";/* empty css                  *//* empty css                 *//* empty css                     */import{a as re,c as T,d as de,e as ue}from"./checkin-c88015f2.js";const _e={class:"checkin-container"},pe={class:"stats-cards"},ve={class:"stat-content"},me={class:"stat-icon-wrapper"},ge={class:"stat-info"},fe={class:"stat-value"},he={class:"stat-content"},we={class:"stat-icon-wrapper"},ye={class:"stat-info"},ke={class:"stat-value"},be={class:"stat-content"},Se={class:"stat-icon-wrapper"},Ce={class:"stat-info"},xe={class:"stat-value"},Ee={class:"stat-content"},Re={class:"stat-icon-wrapper"},Ie={class:"stat-info"},Be={class:"stat-value"},De={__name:"CheckIn",setup(ze){const I=c(!1),y=c([]),o=c({name:"",dateRange:[]}),r=c(1),p=c(20),S=c(0),d=c([]),v=c({total_checkins:0,unique_users:0,today_checkins:0,week_checkins:0}),P=H(()=>{const s=new Map;return y.value.forEach(e=>{e.user&&e.user.name&&s.set(e.user.name,{user_id:e.user.id,name:e.user.name})}),Array.from(s.values())}),V=s=>{if(!s)return"";const e=new Date(s),_=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),C=String(e.getDate()).padStart(2,"0"),x=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),E=String(e.getSeconds()).padStart(2,"0");return`${_}年${i}月${C}日 ${x}点${m}分${E}秒`},F=async()=>{r.value=1,await u()},u=async()=>{const s={page:r.value,page_size:p.value};o.value.name&&(s.name=o.value.name),o.value.dateRange&&o.value.dateRange.length===2&&(s.start_date=o.value.dateRange[0].toISOString().split("T")[0],s.end_date=o.value.dateRange[1].toISOString().split("T")[0]);const e=await T(s);y.value=e.records||[],S.value=e.total||0},$=async()=>{o.value={name:"",dateRange:[]},r.value=1,await u()},M=async s=>{try{await z.confirm("确定要删除这条打卡记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await de(s.id),w.success("删除成功"),await u()}catch(e){e!=="cancel"&&w.error("删除失败")}},U=s=>{d.value=s.map(e=>e.id)},j=async()=>{if(d.value.length===0){w.warning("请选择要删除的记录");return}try{await z.confirm(`确定要删除选中的 ${d.value.length} 条打卡记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue(d.value),w.success("批量删除成功"),d.value=[],await u()}catch(s){s!=="cancel"&&w.error("批量删除失败")}},q=async()=>{try{I.value=!0;const[s,e]=await Promise.all([re(),T({page:1,page_size:p.value})]);console.log("统计数据:",s),console.log("打卡记录:",e),v.value=s||{},y.value=e.records||[],S.value=e.total||0}catch(s){console.error("获取打卡记录失败:",s)}finally{I.value=!1}};return Q(()=>{q()}),(s,e)=>{const _=X,i=W,C=ie,x=Z,m=ee,E=te,k=ae,L=se,g=ne,N=le,O=oe;return R(),B("div",_e,[t(i,{shadow:"hover"},{header:n(()=>[...e[4]||(e[4]=[a("div",{class:"card-header"},[a("span",null,"打卡管理")],-1)])]),default:n(()=>[a("div",pe,[t(i,{shadow:"hover",class:"stat-card"},{default:n(()=>[a("div",ve,[a("div",me,[t(_,{class:"stat-icon"},{default:n(()=>[t(b(D))]),_:1})]),a("div",ge,[e[5]||(e[5]=a("div",{class:"stat-label"},"总打卡次数",-1)),a("div",fe,f(v.value.total_checkins),1)])])]),_:1}),t(i,{shadow:"hover",class:"stat-card"},{default:n(()=>[a("div",he,[a("div",we,[t(_,{class:"stat-icon"},{default:n(()=>[t(b(D))]),_:1})]),a("div",ye,[e[6]||(e[6]=a("div",{class:"stat-label"},"打卡用户数",-1)),a("div",ke,f(v.value.unique_users),1)])])]),_:1}),t(i,{shadow:"hover",class:"stat-card"},{default:n(()=>[a("div",be,[a("div",Se,[t(_,{class:"stat-icon"},{default:n(()=>[t(b(Y))]),_:1})]),a("div",Ce,[e[7]||(e[7]=a("div",{class:"stat-label"},"今日打卡",-1)),a("div",xe,f(v.value.today_checkins),1)])])]),_:1}),t(i,{shadow:"hover",class:"stat-card"},{default:n(()=>[a("div",Ee,[a("div",Re,[t(_,{class:"stat-icon"},{default:n(()=>[t(b(G))]),_:1})]),a("div",Ie,[e[8]||(e[8]=a("div",{class:"stat-label"},"本周打卡",-1)),a("div",Be,f(v.value.week_checkins),1)])])]),_:1})]),t(L,{inline:!0,model:o.value,style:{"margin-bottom":"20px"}},{default:n(()=>[t(m,{label:"姓名"},{default:n(()=>[t(x,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.name=l),placeholder:"请选择姓名",style:{width:"200px"},clearable:""},{default:n(()=>[(R(!0),B(J,null,K(P.value,l=>(R(),ce(C,{key:l.user_id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"时间"},{default:n(()=>[t(E,{modelValue:o.value.dateRange,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),t(m,null,{default:n(()=>[t(k,{type:"primary",onClick:F},{default:n(()=>[...e[9]||(e[9]=[h("查询",-1)])]),_:1}),t(k,{onClick:$},{default:n(()=>[...e[10]||(e[10]=[h("重置",-1)])]),_:1}),t(k,{type:"danger",disabled:d.value.length===0,onClick:j},{default:n(()=>[...e[11]||(e[11]=[h("批量删除",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),t(N,{data:y.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold"},onSelectionChange:U},{default:n(()=>[t(g,{type:"selection",width:"55",align:"center"}),t(g,{type:"index",label:"序号",width:"80",align:"center",index:l=>(r.value-1)*p.value+l+1},null,8,["index"]),t(g,{prop:"user.name",label:"姓名","min-width":"120",align:"center"}),t(g,{prop:"checkin_time",label:"打卡时间","min-width":"180",align:"center"},{default:n(l=>[h(f(V(l.row.checkin_time)),1)]),_:1}),t(g,{label:"操作",width:"100",align:"center"},{default:n(l=>[t(k,{type:"danger",size:"small",onClick:Te=>M(l.row)},{default:n(()=>[...e[12]||(e[12]=[h(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(O,{"current-page":r.value,"onUpdate:currentPage":e[2]||(e[2]=l=>r.value=l),"page-size":p.value,"onUpdate:pageSize":e[3]||(e[3]=l=>p.value=l),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1})])}}},qe=A(De,[["__scopeId","data-v-dccb6489"]]);export{qe as default};
