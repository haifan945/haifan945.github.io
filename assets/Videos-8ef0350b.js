import{_ as oe,c as N,a as w,b as R,d as s,e as l,u as t,i as Y,w as a,G as ee,aa as Q,O as M,t as D,y as T,r as v,ab as z,V as de,n as ne,P as se,ac as ge,ad as be,o as Ve,E as he,f as we,l as x,D as Ue,J as le,N as Ce,a5 as ke,I as xe,F as Ee,m as $e,q as Se,a6 as ze,a7 as Le,s as Re,U as Fe,S as Ie,W as Te,R as De,T as Pe,Y as Be,Q as Me}from"./index-bc0a5eae.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     */import{s as P}from"./request-cb2fba24.js";/* empty css                  *//* empty css                 *//* empty css                        *//* empty css                      *//* empty css                  */import{I as Ne}from"./ImageUpload-c26cabbc.js";import{g as Oe}from"./category-b76a3f16.js";import{s as L,c as te}from"./message-4842d644.js";async function je(){return P({url:"/videos",method:"GET"})}async function qe(p){return P({url:"/videos",method:"POST",data:p})}async function ae(p,h){return P({url:`/videos/${p}`,method:"PUT",data:h})}async function Ge(p){return P({url:`/videos/${p}`,method:"DELETE"})}async function He(p){return P({url:"/videos/batch",method:"DELETE",data:{video_ids:p}})}const We={class:"video-upload-container"},Ae={class:"input-row"},Je={key:0,class:"file-info"},Qe={class:"file-preview"},Ye=["src"],Ke={class:"file-actions"},Xe={key:1,class:"upload-progress"},Ze={class:"progress-text"},el={key:2,class:"video-info"},ll={class:"video-url"},tl={__name:"VideoUpload",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"请输入视频URL"},buttonText:{type:String,default:"上传视频"},uploadUrl:{type:String,default:()=>"http://192.168.124.11:8000/api/qiniu/upload-video"},uploadHeaders:{type:Object,default:()=>({})},maxSize:{type:Number,default:100},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(p,{emit:h}){const E=p,m=h,y=v(null),f=v(!1),i=v(0),n=v(null),U=v(""),u=N({get:()=>E.modelValue,set:c=>m("update:modelValue",c)}),F=(c,_)=>{const I=c.raw.type.startsWith("video/"),C=c.raw.size/1024/1024<E.maxSize;return I?C?(n.value=c.raw,U.value=URL.createObjectURL(c.raw),!1):(z.error(`视频大小不能超过 ${E.maxSize}MB！`),!1):(z.error("只能上传视频文件！"),!1)},g=()=>{n.value&&(f.value=!0,i.value=0,y.value.submit())},S=()=>{U.value&&URL.revokeObjectURL(U.value),n.value=null,U.value="",y.value.clearFiles()},O=()=>{f.value=!1,i.value=0,n.value=null,U.value="",y.value.clearFiles(),z.info("已取消上传")},j=c=>{c.percent&&(i.value=Math.round(c.percent))},q=c=>{c.success?(u.value=c.url,z.success("视频上传成功")):z.error(c.error||"视频上传失败"),f.value=!1,i.value=0,n.value=null,U.value="",y.value.clearFiles()},G=c=>{z.error("视频上传失败，请重试"),f.value=!1,i.value=0},H=()=>{u.value=""};return(c,_)=>{const I=de,C=ne,$=se,W=ge,A=be;return w(),R("div",We,[s("div",Ae,[l(I,{modelValue:t(u),"onUpdate:modelValue":_[0]||(_[0]=J=>Y(u)?u.value=J:null),placeholder:p.placeholder,disabled:p.disabled},null,8,["modelValue","placeholder","disabled"]),l(W,{action:p.uploadUrl,headers:p.uploadHeaders,"show-file-list":!1,"on-success":q,"on-change":F,"on-progress":j,"on-error":G,accept:"video/*",limit:1,disabled:p.disabled||t(f)||t(n),"auto-upload":!1,ref_key:"uploadRef",ref:y},{default:a(()=>[l($,{type:"primary",size:"small",disabled:p.disabled||t(f)||t(n)},{default:a(()=>[l(C,null,{default:a(()=>[l(t(ee))]),_:1}),_[1]||(_[1]=s("span",null,"选择视频",-1))]),_:1},8,["disabled"])]),_:1},8,["action","headers","disabled"])]),t(n)&&!t(f)?(w(),R("div",Je,[s("div",Qe,[s("video",{src:t(U),controls:"",style:{width:"100%","max-width":"400px"}},null,8,Ye)]),s("div",Ke,[l($,{type:"primary",size:"small",onClick:g},{default:a(()=>[l(C,null,{default:a(()=>[l(t(ee))]),_:1}),_[2]||(_[2]=s("span",null,"确认",-1))]),_:1}),l($,{size:"small",onClick:S},{default:a(()=>[l(C,null,{default:a(()=>[l(t(Q))]),_:1}),_[3]||(_[3]=s("span",null,"取消",-1))]),_:1})])])):M("",!0),t(f)?(w(),R("div",Xe,[l(A,{percentage:t(i)},null,8,["percentage"]),s("span",Ze,D(t(i))+"%",1),l($,{type:"danger",size:"small",onClick:O},{default:a(()=>[l(C,null,{default:a(()=>[l(t(Q))]),_:1}),_[4]||(_[4]=s("span",null,"取消上传",-1))]),_:1})])):M("",!0),t(u)?(w(),R("div",el,[s("span",ll,D(t(u)),1),p.disabled?M("",!0):(w(),T($,{key:0,type:"danger",size:"small",onClick:H},{default:a(()=>[l(C,null,{default:a(()=>[l(t(Q))]),_:1}),_[5]||(_[5]=s("span",null,"删除",-1))]),_:1}))])):M("",!0)])}}},al=oe(tl,[["__scopeId","data-v-cbc63246"]]);const ol={class:"videos-container"},dl={class:"search-bar"},nl={class:"category-buttons"},sl={class:"action-buttons"},il={class:"action-buttons"},rl={class:"dialog-footer"},ul={__name:"Videos",setup(p){const h=v(!1),E=v("新建视频"),m=v(!1),y=v(null),f=v([]),i=v({category_id:"6998386423579b8fe8c1093d"}),n=v({id:"",title:"",description:"",cover:"",video_url:"",duration:0,category_id:"6998386423579b8fe8c1093d",is_published:!0,sort_order:0}),U={title:[{required:!0,message:"请输入视频标题",trigger:"blur"}],video_url:[{required:!0,message:"请输入视频文件URL",trigger:"blur"}],category_id:[{required:!0,message:"请选择分类",trigger:"change"}]},u=v([]),F=v([]),g=v(1),S=v(20),O=N(()=>{let o=u.value;i.value.category_id&&(o=o.filter(b=>b.category_id===i.value.category_id)),o=o.sort((b,V)=>b.sort_order-V.sort_order);const e=(g.value-1)*S.value,r=e+S.value;return o.slice(e,r)}),j=N(()=>{let o=u.value;return i.value.category_id&&(o=o.filter(e=>e.category_id===i.value.category_id)),o.length}),q=N(()=>F.value.filter(o=>o.type==="video").sort((o,e)=>o.sort_order-e.sort_order)),G=o=>{const e=F.value.find(r=>r.id===o);return e?e.name:"未分类"},H=o=>{if(!o)return"0秒";const e=Math.floor(o/60),r=o%60;if(e>=60){const b=Math.floor(e/60),V=e%60;return`${b}小时${V}分${r}秒`}return`${e}分${r}秒`},c=async()=>{try{m.value=!0;const o=await je();u.value=o||[]}finally{m.value=!1}},_=async()=>{try{const o=await Oe();F.value=o||[]}catch(o){console.error("加载分类失败:",o)}},I=()=>{E.value="新建视频",n.value={id:"",title:"",description:"",cover:"",video_url:"",duration:0,category_id:"",is_published:!0,sort_order:0},y.value&&y.value.clearValidate(),h.value=!0},C=o=>{E.value="编辑视频",n.value={id:o.id,title:o.title,description:o.description,cover:o.cover,video_url:o.video_url,duration:o.duration,category_id:o.category_id,is_published:o.is_published,sort_order:o.sort_order},y.value&&y.value.clearValidate(),h.value=!0},$=async o=>{try{m.value=!0,await ae(o.id,{is_published:o.is_published}),L("状态更新成功")}finally{m.value=!1}},W=o=>{te("确定要删除该视频吗？").then(async()=>{try{m.value=!0,await Ge(o),u.value=u.value.filter(e=>e.id!==o),L("删除成功")}finally{m.value=!1}}).catch(()=>{})},A=o=>{f.value=o},J=()=>{if(f.value.length===0){L("请先选择要删除的视频","warning");return}te(`确定要删除选中的${f.value.length}个视频吗？`).then(async()=>{try{m.value=!0;const o=f.value.map(e=>e.id);await He(o),u.value=u.value.filter(e=>!f.value.some(r=>r.id===e.id)),f.value=[],L("批量删除成功")}finally{m.value=!1}}).catch(()=>{})},ie=async()=>{y.value&&await y.value.validate(async o=>{if(o)try{if(m.value=!0,n.value.id){const e=await ae(n.value.id,n.value),r=u.value.findIndex(b=>b.id===n.value.id);r!==-1&&(u.value[r]=e),L("编辑成功")}else{const e=await qe(n.value);u.value.unshift(e),L("创建成功")}h.value=!1}finally{m.value=!1}})};return Ve(()=>{c(),_()}),(o,e)=>{const r=se,b=ne,V=Se,re=ze,K=Le,ue=Re,pe=Fe,ce=he,X=de,k=Ie,Z=Te,fe=Me,ve=De,_e=Pe,me=we,ye=Be;return w(),R("div",ol,[l(ce,{shadow:"hover"},{header:a(()=>[...e[17]||(e[17]=[s("div",{class:"card-header"},[s("span",null,"视频管理")],-1)])]),default:a(()=>[s("div",dl,[s("div",nl,[l(r,{type:t(i).category_id==="6998386423579b8fe8c1093d"?"primary":"default",onClick:e[0]||(e[0]=d=>{t(i).category_id="6998386423579b8fe8c1093d",g.value=1})},{default:a(()=>[...e[18]||(e[18]=[x(" AI人工智能 ",-1)])]),_:1},8,["type"]),l(r,{type:t(i).category_id==="69942671625fd3cd2f46e1dd"?"primary":"default",onClick:e[1]||(e[1]=d=>{t(i).category_id="69942671625fd3cd2f46e1dd",g.value=1})},{default:a(()=>[...e[19]||(e[19]=[x(" Scratch编程 ",-1)])]),_:1},8,["type"]),l(r,{type:t(i).category_id==="6994267c625fd3cd2f46e1df"?"primary":"default",onClick:e[2]||(e[2]=d=>{t(i).category_id="6994267c625fd3cd2f46e1df",g.value=1})},{default:a(()=>[...e[20]||(e[20]=[x(" Python编程 ",-1)])]),_:1},8,["type"]),l(r,{type:t(i).category_id==="69945cd998466f943b60a8bd"?"primary":"default",onClick:e[3]||(e[3]=d=>{t(i).category_id="69945cd998466f943b60a8bd",g.value=1})},{default:a(()=>[...e[21]||(e[21]=[x(" C++编程 ",-1)])]),_:1},8,["type"]),l(r,{type:t(i).category_id==="69945d0298466f943b60a8be"?"primary":"default",onClick:e[4]||(e[4]=d=>{t(i).category_id="69945d0298466f943b60a8be",g.value=1})},{default:a(()=>[...e[22]||(e[22]=[x(" 计算机基础 ",-1)])]),_:1},8,["type"]),l(r,{type:t(i).category_id===""?"primary":"default",onClick:e[5]||(e[5]=d=>{t(i).category_id="",g.value=1})},{default:a(()=>[...e[23]||(e[23]=[x(" 全部分类 ",-1)])]),_:1},8,["type"])]),s("div",sl,[l(r,{type:"primary",onClick:I},{default:a(()=>[l(b,null,{default:a(()=>[l(t(Ue))]),_:1}),e[24]||(e[24]=s("span",null,"新建视频",-1))]),_:1}),l(r,{type:"danger",disabled:t(f).length===0,onClick:J},{default:a(()=>[l(b,null,{default:a(()=>[l(t(le))]),_:1}),e[25]||(e[25]=s("span",null,"批量删除",-1))]),_:1},8,["disabled"])])]),Ce((w(),T(ue,{data:t(O),style:{width:"100%"},onSelectionChange:A},{default:a(()=>[l(V,{type:"selection",width:"55"}),l(V,{label:"序号",width:"100","class-name":"index-column"},{default:a(d=>[s("span",null,D((t(g)-1)*t(S)+d.$index+1),1)]),_:1}),l(V,{label:"封面",width:"120"},{default:a(d=>[d.row.cover?(w(),T(re,{key:0,src:d.row.cover,style:{width:"80px",height:"45px"},fit:"cover"},null,8,["src"])):(w(),T(b,{key:1,size:32},{default:a(()=>[l(t(ke))]),_:1}))]),_:1}),l(V,{prop:"title",label:"视频标题","min-width":"200","class-name":"title-column"}),l(V,{prop:"category_id",label:"分类",width:"150"},{default:a(d=>[s("span",null,D(G(d.row.category_id)),1)]),_:1}),l(V,{prop:"duration",label:"时长",width:"120",align:"center"},{default:a(d=>[s("span",null,D(H(d.row.duration)),1)]),_:1}),l(V,{label:"发布状态",width:"100",align:"center"},{default:a(d=>[l(K,{modelValue:d.row.is_published,"onUpdate:modelValue":B=>d.row.is_published=B,onChange:B=>$(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(V,{label:"操作",width:"200",fixed:"right",align:"center"},{default:a(d=>[s("div",il,[l(r,{size:"small",onClick:B=>C(d.row)},{default:a(()=>[l(b,null,{default:a(()=>[l(t(xe))]),_:1}),e[26]||(e[26]=s("span",null,"编辑",-1))]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",onClick:B=>W(d.row.id)},{default:a(()=>[l(b,null,{default:a(()=>[l(t(le))]),_:1}),e[27]||(e[27]=s("span",null,"删除",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ye,t(m)]]),l(pe,{"current-page":t(g),"onUpdate:currentPage":e[6]||(e[6]=d=>Y(g)?g.value=d:null),"page-size":t(S),total:t(j),layout:"total, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),l(me,{modelValue:t(h),"onUpdate:modelValue":e[16]||(e[16]=d=>Y(h)?h.value=d:null),title:t(E),width:"600px"},{footer:a(()=>[s("span",rl,[l(r,{onClick:e[15]||(e[15]=d=>h.value=!1)},{default:a(()=>[...e[28]||(e[28]=[x("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:ie},{default:a(()=>[...e[29]||(e[29]=[x("确定",-1)])]),_:1})])]),default:a(()=>[l(_e,{model:t(n),rules:U,ref_key:"videoFormRef",ref:y,"label-width":"100px"},{default:a(()=>[l(k,{label:"视频标题",prop:"title"},{default:a(()=>[l(X,{modelValue:t(n).title,"onUpdate:modelValue":e[7]||(e[7]=d=>t(n).title=d),placeholder:"请输入视频标题"},null,8,["modelValue"])]),_:1}),l(k,{label:"视频简介",prop:"description"},{default:a(()=>[l(X,{modelValue:t(n).description,"onUpdate:modelValue":e[8]||(e[8]=d=>t(n).description=d),type:"textarea",rows:3,placeholder:"请输入视频简介"},null,8,["modelValue"])]),_:1}),l(k,{label:"视频封面",prop:"cover"},{default:a(()=>[l(Ne,{modelValue:t(n).cover,"onUpdate:modelValue":e[9]||(e[9]=d=>t(n).cover=d),placeholder:"请输入封面图片URL","button-text":"上传封面"},null,8,["modelValue"])]),_:1}),l(k,{label:"视频文件",prop:"video_url"},{default:a(()=>[l(al,{modelValue:t(n).video_url,"onUpdate:modelValue":e[10]||(e[10]=d=>t(n).video_url=d),placeholder:"请输入视频文件URL","button-text":"上传视频"},null,8,["modelValue"])]),_:1}),l(k,{label:"视频时长",prop:"duration"},{default:a(()=>[l(Z,{modelValue:t(n).duration,"onUpdate:modelValue":e[11]||(e[11]=d=>t(n).duration=d),min:0,placeholder:"请输入视频时长（秒）",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(k,{label:"所属分类",prop:"category_id"},{default:a(()=>[l(ve,{modelValue:t(n).category_id,"onUpdate:modelValue":e[12]||(e[12]=d=>t(n).category_id=d),placeholder:"请选择分类",style:{width:"100%"}},{default:a(()=>[(w(!0),R(Ee,null,$e(t(q),d=>(w(),T(fe,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"是否发布",prop:"is_published"},{default:a(()=>[l(K,{modelValue:t(n).is_published,"onUpdate:modelValue":e[13]||(e[13]=d=>t(n).is_published=d)},null,8,["modelValue"])]),_:1}),l(k,{label:"排序顺序",prop:"sort_order"},{default:a(()=>[l(Z,{modelValue:t(n).sort_order,"onUpdate:modelValue":e[14]||(e[14]=d=>t(n).sort_order=d),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},kl=oe(ul,[["__scopeId","data-v-0cc188b0"]]);export{kl as default};
