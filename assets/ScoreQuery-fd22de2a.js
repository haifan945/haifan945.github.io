import{_ as O,c as z,o as X,a as g,b as k,e as t,w as o,ab as c,E as j,d as m,u as s,i as V,F as H,m as J,l as f,y as E,t as h,O as $,r as p,ae as R,Q as K,R as W,P as Y,q as Z,X as ee,s as te,ag as le}from"./index-dab368ea.js";import{s as C}from"./request-afa285ff.js";/* empty css                  */import{g as re}from"./user-4c09b9db.js";/* empty css                 *//* empty css                   */const oe=()=>C({url:"/answer-records",method:"get"}),ae=y=>C({url:`/answer-records/${y}`,method:"get"}),S=y=>C({url:`/answer-records/${y}`,method:"delete"});const ne={class:"score-query-container"},se={class:"score-query-header"},ce={class:"filter-controls"},ie={style:{color:"#67c23a"}},ue={style:{color:"#f56c6c"}},de={__name:"ScoreQuery",setup(y){const w=p(!1),b=p([]),B=p([]),i=p(""),_=p(""),u=p([]),x=z(()=>_.value?b.value.filter(e=>e.category===_.value):b.value),M=async()=>{try{const e=await re();B.value=e||[]}catch(e){c.error("获取用户列表失败"),console.error(e)}},v=async()=>{try{w.value=!0;let e;i.value?e=await ae(i.value):e=await oe(),b.value=e||[]}catch(e){c.error("获取答题记录失败"),console.error(e)}finally{w.value=!1}},Q=e=>{i.value=e,v()},U=()=>{},A=e=>e>=.9?"success":e>=.7?"":e>=.5?"warning":"danger",P=e=>{if(!e)return"0秒";const r=Math.floor(e/3600),a=Math.floor(e%3600/60),d=e%60;return r>0?`${r}小时${a}分${d}秒`:a>0?`${a}分${d}秒`:`${d}秒`},D=e=>{R.confirm("确定要删除这条答题记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await S(e.id),c.success("删除成功"),v()}catch(r){c.error("删除失败"),console.error(r)}}).catch(()=>{})},N=e=>{u.value=e},q=()=>{if(u.value.length===0){c.warning("请先选择要删除的记录");return}R.confirm(`确定要删除选中的 ${u.value.length} 条答题记录吗？`,"批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=u.value.map(r=>S(r.id));await Promise.all(e),c.success("批量删除成功"),u.value=[],v()}catch(e){c.error("批量删除失败"),console.error(e)}}).catch(()=>{})};return X(()=>{M(),v()}),(e,r)=>{const a=K,d=W,T=Y,n=Z,F=ee,I=te,G=le,L=j;return g(),k("div",ne,[t(L,{shadow:"hover"},{default:o(()=>[m("div",se,[r[3]||(r[3]=m("h2",null,"成绩查询",-1)),m("div",ce,[t(d,{modelValue:s(i),"onUpdate:modelValue":r[0]||(r[0]=l=>V(i)?i.value=l:null),placeholder:"选择用户",clearable:"",style:{width:"200px","margin-right":"12px"},onChange:Q},{default:o(()=>[t(a,{label:"全部用户",value:""}),(g(!0),k(H,null,J(s(B),l=>(g(),E(a,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(d,{modelValue:s(_),"onUpdate:modelValue":r[1]||(r[1]=l=>V(_)?_.value=l:null),placeholder:"选择答题分类",clearable:"",style:{width:"200px"},onChange:U},{default:o(()=>[t(a,{label:"全部",value:""}),t(a,{label:"专项训练",value:"专项训练"}),t(a,{label:"真题练习",value:"真题练习"}),t(a,{label:"GESP",value:"GESP"}),t(a,{label:"QCEIT",value:"QCEIT"})]),_:1},8,["modelValue"]),t(T,{type:"danger",disabled:s(u).length===0,onClick:q},{default:o(()=>[...r[2]||(r[2]=[f(" 批量删除 ",-1)])]),_:1},8,["disabled"])])]),!s(w)&&s(x).length>0?(g(),E(I,{key:0,data:s(x),stripe:"",border:"",style:{width:"100%","margin-top":"20px"},onSelectionChange:N},{default:o(()=>[t(n,{type:"selection",width:"55",align:"center"}),t(n,{type:"index",label:"序号",width:"100",align:"center"}),t(n,{label:"用户",width:"120",align:"center"},{default:o(l=>[f(h(l.row.user_info?l.row.user_info.name:"未知用户"),1)]),_:1}),t(n,{prop:"category",label:"答题分类",width:"120",align:"center"}),t(n,{prop:"total_count",label:"答题总数",width:"100",align:"center"}),t(n,{prop:"correct_count",label:"正确数",width:"100",align:"center"},{default:o(l=>[m("span",ie,h(l.row.correct_count),1)]),_:1}),t(n,{prop:"wrong_count",label:"错误数",width:"100",align:"center"},{default:o(l=>[m("span",ue,h(l.row.wrong_count),1)]),_:1}),t(n,{prop:"accuracy",label:"正确率",width:"100",align:"center"},{default:o(l=>[t(F,{type:A(l.row.accuracy)},{default:o(()=>[f(h((l.row.accuracy*100).toFixed(1))+"% ",1)]),_:2},1032,["type"])]),_:1}),t(n,{prop:"duration",label:"答题用时",width:"120",align:"center"},{default:o(l=>[f(h(P(l.row.duration)),1)]),_:1}),t(n,{prop:"submit_time",label:"提交时间",width:"180",align:"center"}),t(n,{label:"操作",width:"100",align:"center"},{default:o(l=>[t(T,{type:"danger",size:"small",link:"",onClick:pe=>D(l.row)},{default:o(()=>[...r[4]||(r[4]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):$("",!0),!s(w)&&s(x).length===0?(g(),E(G,{key:1,description:"暂无答题记录",style:{"margin-top":"40px"}})):$("",!0)]),_:1})])}}},we=O(de,[["__scopeId","data-v-0049f9e7"]]);export{we as default};
